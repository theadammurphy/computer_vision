<!DOCTYPE html>

<html style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: sans-serif; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%; font-size: 10px; -webkit-tap-highlight-color: rgba(0, 0, 0, 0)">
<body style='-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 0; font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; font-size: 13px; line-height: 1.428571; color: #000; background-color: #fff; position: absolute; left: 0; right: 0; top: 0; bottom: 0; overflow: visible; padding: 8px'>
<div style='font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; font-size: 14px; line-height: 20px; overflow-y: hidden; overflow-x: auto; width: 100%; padding-top: 0; margin: 0; outline: none; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; min-height: 100%; overflow: visible; border-top: none' tabindex="-1">
<div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin-right: auto; margin-left: auto; padding-left: 0; padding-right: 0">
<div style="border-radius: 2px; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; border-width: 1px; border-style: solid; border-color: transparent; width: 100%; padding: 5px; margin: 0; outline: none; border-left-width: 1px; padding-left: 5px; background: linear-gradient(to right, transparent -40px, transparent 1px, transparent 1px, transparent 100%); -webkit-box-orient: horizontal; -webkit-box-align: stretch; -moz-box-orient: horizontal; -moz-box-align: stretch; box-orient: horizontal; box-align: stretch; display: flex; flex-direction: row; align-items: stretch"><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; padding: 0.4em; margin: 0; font-family: monospace; text-align: right; line-height: 1.21429em; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; cursor: default; color: #303F9F; border-top: 1px solid transparent; padding-top: 5pt; min-width: 0">
</div><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; -moz-box-orient: vertical; -moz-box-align: stretch; box-orient: vertical; box-align: stretch; display: flex; flex-direction: column; align-items: stretch; -webkit-box-flex: 1; -moz-box-flex: 1; box-flex: 1; flex: 1">
<div style="outline: none; resize: none; width: inherit; border-style: none; padding: 0.5em 0.5em 0.5em 0.4em; color: #000; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; overflow-x: auto; overflow-y: hidden">
<h1 style='-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; color: inherit; margin-bottom: 9px; font-size: 185.7%; margin: 1.08em 0 0 0; font-weight: bold; line-height: 1; margin-top: 0.538em'>Apple Classifier - Custom Dataset - 80% Accuracy<a href="#Apple-Classifier---Custom-Dataset---80%-Accuracy" style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; background-color: transparent; color: #337ab7; text-decoration: none"></a></h1><p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left; margin-top: 1em">In this article, I will walk you through the apple classifier I created in using the fastai library with Google Colab. It's an incredibly noisy dataset and the total amount of training images is small but the model achieves 80% accuracy and makes mistakes in places where even humans would. For this reason, I think it's a great score.</p>
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">The classes of apple we are going to work with are: pink lady, braeburn, red delicious, golden delicious, granny smith and opal. The first three are red and the last three are green.</p>
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">First, we need to set up our coding environment</p>
<h2 style='-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; color: inherit; margin-top: 18px; margin-bottom: 9px; font-size: 157.1%; margin: 1.27em 0 0 0; font-weight: bold; line-height: 1'>Setting Up Google Colab<a href="#Setting-Up-Google-Colab" style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; background-color: transparent; color: #337ab7; text-decoration: none"></a></h2><p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left; margin-top: 1em">One of the best ways to build deep learning models is to use Google Colab as it's super easy to set up and gives you access to a GPU for free.</p>
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">First, you need to install the necessary packages to work with the fastai library.</p>
<pre style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; overflow: auto; font-family: monospace; display: block; word-break: break-all; word-wrap: break-word; border-radius: 2px; line-height: inherit; white-space: pre; margin: 1em 2em; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0"><code style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: monospace; white-space: pre; border-radius: 0; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0">!curl -s https://course.fast.ai/setup/colab | bash
Updating fastai...
Done.</code></pre>
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">Then mount your Google Drive as you will be storing and accessing all your data from there. Click the file tab on the left hand side, then 'Mount Drive' on the toolbar that appears and follow the instructions.</p>
<h2 style='-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; color: inherit; margin-top: 18px; margin-bottom: 9px; font-size: 157.1%; margin: 1.27em 0 0 0; font-weight: bold; line-height: 1'>Import Necessary Modules<a href="#Import-Necessary-Modules" style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; background-color: transparent; color: #337ab7; text-decoration: none"></a></h2><p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left; margin-top: 1em">We'll build this image classifier with the <a href="https://docs.fast.ai/" style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; background-color: transparent; color: #337ab7; text-decoration: none">fastai library</a>, so we need to import everything from <code style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: monospace; border-radius: 2px; white-space: pre; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0">fastai.vision</code> and also the <code style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: monospace; border-radius: 2px; white-space: pre; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0">error_rate</code> which we'll print to the screen to see how well the model performs.</p>
<div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; background: #f8f8f8"><pre style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; overflow: auto; font-family: monospace; display: block; word-break: break-all; word-wrap: break-word; border-radius: 2px; line-height: inherit; white-space: pre; margin: 1em 2em; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0"><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box"></span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #008000; font-weight: bold">from</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #00F; font-weight: bold">fastai.vision</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #008000; font-weight: bold">import</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">*</span>
<span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #008000; font-weight: bold">from</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #00F; font-weight: bold">fastai.metrics</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #008000; font-weight: bold">import</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">error_rate</span>
</pre></div>
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">Now we're ready to start.</p>
<h2 style='-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; color: inherit; margin-top: 18px; margin-bottom: 9px; font-size: 157.1%; margin: 1.27em 0 0 0; font-weight: bold; line-height: 1'>Setting Up Directory Structure<a href="#Setting-Up-Directory-Structure" style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; background-color: transparent; color: #337ab7; text-decoration: none"></a></h2><p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left; margin-top: 1em">All the files and directories will revolved around the variable <code style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: monospace; border-radius: 2px; white-space: pre; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0">path</code>, so let's create that now.</p>
<div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; background: #f8f8f8"><pre style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; overflow: auto; font-family: monospace; display: block; word-break: break-all; word-wrap: break-word; border-radius: 2px; line-height: inherit; white-space: pre; margin: 1em 2em; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0"><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box"></span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #008000; font-weight: bold">from</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #00F; font-weight: bold">pathlib</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #008000; font-weight: bold">import</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">Path</span>

<span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">path</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">=</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">Path</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #BA2121">'data/apples'</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">)</span>
</pre></div>
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">There is no need to create any other path variables since you will just add one or two directories after <code style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: monospace; border-radius: 2px; white-space: pre; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0">path</code> to get wherever you want to go.</p>
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">Now we need to create 6 directories each named after a variety of apple.</p>
<div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; background: #f8f8f8"><pre style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; overflow: auto; font-family: monospace; display: block; word-break: break-all; word-wrap: break-word; border-radius: 2px; line-height: inherit; white-space: pre; margin: 1em 2em; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0"><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box"></span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #008000; font-weight: bold">import</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #00F; font-weight: bold">os</span>

<span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #408080; font-style: italic"># Create list of directory names</span>
<span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">folders</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">=</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">[</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #BA2121">'pink_lady'</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #BA2121">'braeburn'</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #BA2121">'red_delicious'</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span> 
          <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #BA2121">'golden_delicious'</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #BA2121">'granny_smith'</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #BA2121">'opal'</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">]</span>

<span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #408080; font-style: italic"># If the directory does not exist, create it</span>
<span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #008000; font-weight: bold">for</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">f</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #A2F; font-weight: bold">in</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">folders</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">:</span>
    <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #008000; font-weight: bold">if</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #A2F; font-weight: bold">not</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">os</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">path</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">isdir</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">path</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">/</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">f</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">):</span>
        <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">os</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">mkdir</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">path</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">/</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">f</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">)</span>
</pre></div>
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">Perfect, now we are ready to start. Let's download our images.</p>
<h2 style='-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; color: inherit; margin-top: 18px; margin-bottom: 9px; font-size: 157.1%; margin: 1.27em 0 0 0; font-weight: bold; line-height: 1'>Downloading Your Custom Dataset<a href="#Downloading-Your-Custom-Dataset" style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; background-color: transparent; color: #337ab7; text-decoration: none"></a></h2><p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left; margin-top: 1em">For each of the varieties of apple, go to Google Images and search <code style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: monospace; border-radius: 2px; white-space: pre; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0">"pink lady apple"</code> including the double quotes as this will only search for images with an exact match. We're going to download a full page of 380 images, so scroll until you it says 'Show more results'.</p>
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">To save us from manually downloading the images, we'll run some Javascript inside our browser. Press <code style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: monospace; border-radius: 2px; white-space: pre; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0">CtrlShiftj</code> on Windows/Linux or <code style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: monospace; border-radius: 2px; white-space: pre; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0">CmdOptj</code> on Mac to open the Javascript console and copy/paste the following.</p>
<div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; background: #f8f8f8"><pre style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; overflow: auto; font-family: monospace; display: block; word-break: break-all; word-wrap: break-word; border-radius: 2px; line-height: inherit; white-space: pre; margin: 1em 2em; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0"><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box"></span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #408080; font-style: italic">// Run this in your Javascript console</span>
<span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">urls</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">=</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #008000">Array</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">from</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #008000">document</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">querySelectorAll</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #BA2121">'.rg_i'</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">)).</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">map</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">el</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">=&gt;</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">el</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">hasAttribute</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #BA2121">'data-src'</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">)</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">?</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">el</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">getAttribute</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #BA2121">'data-src'</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">)</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">:</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">el</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">getAttribute</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #BA2121">'data-iurl'</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">));</span>
<span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #008000">window</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">open</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #BA2121">'data:text/csv;charset=utf-8,'</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">+</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">escape</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">urls</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">join</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #BA2121">'\n'</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">)));</span>
</pre></div>
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">It will download the links to all the image files on the page and save them in your Downloads folder as <code style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: monospace; border-radius: 2px; white-space: pre; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0">download.csv</code>. Note: you may need to disable AdBlocker for this to work.</p>
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">Once you've downloaded the csv file, move it to <code style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: monospace; border-radius: 2px; white-space: pre; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0">path</code> and rename it to <code style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: monospace; border-radius: 2px; white-space: pre; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0">urls_pink_lady.csv</code> or something similarly appropriate. Do not move it inside the <code style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: monospace; border-radius: 2px; white-space: pre; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0">pink_lady</code> folder as that is for image files only.</p>
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">This is a manual process and could be automated if you had tens or hundreds of categories but works fine for our purposes.</p>
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">Once you have downloaded the csv files for all 6 classes and moved them to <code style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: monospace; border-radius: 2px; white-space: pre; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0">path</code>, it's time to actually download the images.</p>
<div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; background: #f8f8f8"><pre style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; overflow: auto; font-family: monospace; display: block; word-break: break-all; word-wrap: break-word; border-radius: 2px; line-height: inherit; white-space: pre; margin: 1em 2em; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0"><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box"></span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">download_images</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">path</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">/</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #BA2121">'urls_braeburn.csv'</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">path</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">/</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #BA2121">'braeburn'</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">)</span>
</pre></div>
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">You can either manually download them all or use a for loop like so</p>
<div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; background: #f8f8f8"><pre style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; overflow: auto; font-family: monospace; display: block; word-break: break-all; word-wrap: break-word; border-radius: 2px; line-height: inherit; white-space: pre; margin: 1em 2em; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0"><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box"></span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">url_files</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">=</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">[</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">f</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #BA2121">'urls_</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #B68; font-weight: bold">{folder}</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #BA2121">.csv'</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #008000; font-weight: bold">for</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">folder</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #A2F; font-weight: bold">in</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">folders</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">]</span>

<span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #408080; font-style: italic"># Sort lists to make sure iterating through them in the same order</span>
<span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">files</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">sort</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">();</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">folders</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">sort</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">()</span>

<span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #008000; font-weight: bold">for</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">url_file</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">folder</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #A2F; font-weight: bold">in</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #008000">zip</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">url_files</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">folders</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">):</span>
    <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">download_images</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">path</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">/</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">url_file</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">path</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">/</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">folder</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">)</span>
</pre></div>
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">Note that your csv file may contain lots of blank lines and <code style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: monospace; border-radius: 2px; white-space: pre; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0">download_images</code> will throw errors when trying to download them. It will still download all the lines with correct urls though, so just ignore the error messages.</p>
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">The final step is to verify the images and delete any that do not open.</p>
<div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; background: #f8f8f8"><pre style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; overflow: auto; font-family: monospace; display: block; word-break: break-all; word-wrap: break-word; border-radius: 2px; line-height: inherit; white-space: pre; margin: 1em 2em; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0"><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box"></span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #008000; font-weight: bold">for</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">f</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #A2F; font-weight: bold">in</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">folders</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">:</span>
    <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">verify_images</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">path</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">/</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">f</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">delete</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">=</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #008000; font-weight: bold">True</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">max_size</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">=</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">500</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">)</span>
</pre></div>
<h2 style='-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; color: inherit; margin-top: 18px; margin-bottom: 9px; font-size: 157.1%; margin: 1.27em 0 0 0; font-weight: bold; line-height: 1'>View Data<a href="#View-Data" style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; background-color: transparent; color: #337ab7; text-decoration: none"></a></h2><p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left; margin-top: 1em">To look at our data, we need to get it into an <code style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: monospace; border-radius: 2px; white-space: pre; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0">ImageDataBunch</code>. Note that I set the random seed beforehand so that the validation set is consistent every time I do it.</p>
<div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; background: #f8f8f8"><pre style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; overflow: auto; font-family: monospace; display: block; word-break: break-all; word-wrap: break-word; border-radius: 2px; line-height: inherit; white-space: pre; margin: 1em 2em; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0"><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box"></span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">np</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">random</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">seed</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">42</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">)</span>
<span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">data</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">=</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">ImageDataBunch</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">from_folder</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">path</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">train</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">=</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #BA2121">'.'</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">valid_pct</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">=</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">0.2</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span> 
                                  <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">ds_tfms</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">=</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">get_transforms</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(),</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">size</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">=</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">224</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span> 
                                  <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">num_workers</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">=</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">4</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">)</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">normalize</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">imagenet_stats</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">)</span>
</pre></div>
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">I set aside 20% of the data to use for validation whilst transforming the images to ensure the model generalized well and finally normalizing them using the ImageNet statistics as we will be using a model that has been pretrained on ImageNet.</p>
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">Let's check the classes, c and the length of our training and validation sets</p>
<div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; background: #f8f8f8"><pre style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; overflow: auto; font-family: monospace; display: block; word-break: break-all; word-wrap: break-word; border-radius: 2px; line-height: inherit; white-space: pre; margin: 1em 2em; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0"><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box"></span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">data</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">classes</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">data</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">c</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #008000">len</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">data</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">train_ds</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">),</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #008000">len</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">data</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">valid_ds</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">)</span>

<span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">([</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #BA2121">'braeburn'</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span>
 <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #BA2121">'golden_delicious'</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span>
 <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #BA2121">'granny_smith'</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span>
 <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #BA2121">'opal'</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span>
 <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #BA2121">'pink_lady'</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span>
 <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #BA2121">'red_delicious'</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">],</span>
 <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">6</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span>
 <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">1460</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span>
 <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">365</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">)</span>
</pre></div>
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">Looks good, as expected there are 6 classes, 1460 images in the training set and 365 in the validation set. Note that this is less than we initially downloaded due to corrupted files that could not be opened.</p>
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">Now let's look at a batch.</p>
<div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; background: #f8f8f8"><pre style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; overflow: auto; font-family: monospace; display: block; word-break: break-all; word-wrap: break-word; border-radius: 2px; line-height: inherit; white-space: pre; margin: 1em 2em; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0"><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box"></span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">data</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">show_batch</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">rows</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">=</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">4</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">figsize</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">=</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">7</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">8</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">))</span>
</pre></div>
</div>
</div>
</div>
<div style="border-radius: 2px; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; border-width: 1px; border-style: solid; border-color: transparent; width: 100%; padding: 5px; margin: 0; outline: none; border-left-width: 1px; padding-left: 5px; background: linear-gradient(to right, transparent -40px, transparent 1px, transparent 1px, transparent 100%); -webkit-box-orient: horizontal; -webkit-box-align: stretch; -moz-box-orient: horizontal; -moz-box-align: stretch; box-orient: horizontal; box-align: stretch; display: flex; flex-direction: row; align-items: stretch"><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; padding: 0.4em; margin: 0; font-family: monospace; text-align: right; line-height: 1.21429em; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; cursor: default; color: #303F9F; border-top: 1px solid transparent; padding-top: 5pt; min-width: 0">
</div><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; -moz-box-orient: vertical; -moz-box-align: stretch; box-orient: vertical; box-align: stretch; display: flex; flex-direction: column; align-items: stretch; -webkit-box-flex: 1; -moz-box-flex: 1; box-flex: 1; flex: 1">
<div style="outline: none; resize: none; width: inherit; border-style: none; padding: 0.5em 0.5em 0.5em 0.4em; color: #000; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; overflow-x: auto; overflow-y: hidden">
<div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">
<img align="left" src="https://raw.githubusercontent.com/theadammurphy/computer_vision/master/apple_classifier/final_html/img/img0.png" style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; border: 0; vertical-align: middle; display: block; margin-left: auto; margin-right: auto; max-width: 100%; height: auto" width="400/"/>
</div>
</div>
</div>
</div>
<div style="border-radius: 2px; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; border-width: 1px; border-style: solid; border-color: transparent; width: 100%; padding: 5px; margin: 0; outline: none; border-left-width: 1px; padding-left: 5px; background: linear-gradient(to right, transparent -40px, transparent 1px, transparent 1px, transparent 100%); -webkit-box-orient: horizontal; -webkit-box-align: stretch; -moz-box-orient: horizontal; -moz-box-align: stretch; box-orient: horizontal; box-align: stretch; display: flex; flex-direction: row; align-items: stretch"><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; padding: 0.4em; margin: 0; font-family: monospace; text-align: right; line-height: 1.21429em; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; cursor: default; color: #303F9F; border-top: 1px solid transparent; padding-top: 5pt; min-width: 0">
</div><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; -moz-box-orient: vertical; -moz-box-align: stretch; box-orient: vertical; box-align: stretch; display: flex; flex-direction: column; align-items: stretch; -webkit-box-flex: 1; -moz-box-flex: 1; box-flex: 1; flex: 1">
<div style="outline: none; resize: none; width: inherit; border-style: none; padding: 0.5em 0.5em 0.5em 0.4em; color: #000; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; overflow-x: auto; overflow-y: hidden">
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">Clearly this batch contains a lot of noise despite our best efforts when downloading the data. Let's build a quick model and see how well it performs regardless. Even if it performs terribly, we'll be able to use some great features of the fastai library to help with data cleaning down the road.</p>
<h2 style='-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; color: inherit; margin-top: 18px; margin-bottom: 9px; font-size: 157.1%; margin: 1.27em 0 0 0; font-weight: bold; line-height: 1'>Training First Model<a href="#Training-First-Model" style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; background-color: transparent; color: #337ab7; text-decoration: none"></a></h2><p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left; margin-top: 1em">Initialize learner with the pretrained resnet34 model and fit for 4 epochs.</p>
<div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; background: #f8f8f8"><pre style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; overflow: auto; font-family: monospace; display: block; word-break: break-all; word-wrap: break-word; border-radius: 2px; line-height: inherit; white-space: pre; margin: 1em 2em; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0"><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box"></span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">learn</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">=</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">cnn_learner</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">data</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">models</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">resnet34</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">metrics</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">=</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">error_rate</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">)</span>
<span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">learn</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">fit_one_cycle</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">4</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">)</span>
</pre></div>
</div>
</div>
</div>
<div style="border-radius: 2px; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; border-width: 1px; border-style: solid; border-color: transparent; width: 100%; padding: 5px; margin: 0; outline: none; border-left-width: 1px; padding-left: 5px; background: linear-gradient(to right, transparent -40px, transparent 1px, transparent 1px, transparent 100%); -webkit-box-orient: horizontal; -webkit-box-align: stretch; -moz-box-orient: horizontal; -moz-box-align: stretch; box-orient: horizontal; box-align: stretch; display: flex; flex-direction: row; align-items: stretch"><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; padding: 0.4em; margin: 0; font-family: monospace; text-align: right; line-height: 1.21429em; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; cursor: default; color: #303F9F; border-top: 1px solid transparent; padding-top: 5pt; min-width: 0">
</div><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; -moz-box-orient: vertical; -moz-box-align: stretch; box-orient: vertical; box-align: stretch; display: flex; flex-direction: column; align-items: stretch; -webkit-box-flex: 1; -moz-box-flex: 1; box-flex: 1; flex: 1">
<div style="outline: none; resize: none; width: inherit; border-style: none; padding: 0.5em 0.5em 0.5em 0.4em; color: #000; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; overflow-x: auto; overflow-y: hidden">
<div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">
<img align="left" src="https://raw.githubusercontent.com/theadammurphy/computer_vision/master/apple_classifier/final_html/img/img1.png" style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; border: 0; vertical-align: middle; display: block; margin-left: auto; margin-right: auto; max-width: 100%; height: auto" width="400/"/>
</div>
</div>
</div>
</div>
<div style="border-radius: 2px; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; border-width: 1px; border-style: solid; border-color: transparent; width: 100%; padding: 5px; margin: 0; outline: none; border-left-width: 1px; padding-left: 5px; background: linear-gradient(to right, transparent -40px, transparent 1px, transparent 1px, transparent 100%); -webkit-box-orient: horizontal; -webkit-box-align: stretch; -moz-box-orient: horizontal; -moz-box-align: stretch; box-orient: horizontal; box-align: stretch; display: flex; flex-direction: row; align-items: stretch"><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; padding: 0.4em; margin: 0; font-family: monospace; text-align: right; line-height: 1.21429em; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; cursor: default; color: #303F9F; border-top: 1px solid transparent; padding-top: 5pt; min-width: 0">
</div><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; -moz-box-orient: vertical; -moz-box-align: stretch; box-orient: vertical; box-align: stretch; display: flex; flex-direction: column; align-items: stretch; -webkit-box-flex: 1; -moz-box-flex: 1; box-flex: 1; flex: 1">
<div style="outline: none; resize: none; width: inherit; border-style: none; padding: 0.5em 0.5em 0.5em 0.4em; color: #000; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; overflow-x: auto; overflow-y: hidden">
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">As expected, the model performs quite poorly on its first attempt. The error rate is 38.6% which means its accuracy is 61.4%. Let's save it regardless so that we can easily load this model again instead of training from scratch.</p>
<div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; background: #f8f8f8"><pre style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; overflow: auto; font-family: monospace; display: block; word-break: break-all; word-wrap: break-word; border-radius: 2px; line-height: inherit; white-space: pre; margin: 1em 2em; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0"><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box"></span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">learn</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">save</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #BA2121">'stage-1'</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">)</span>
</pre></div>
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">Now it's time to look at the results. I imagine a lot of these errors will come from noisy data.</p>
<h2 style='-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; color: inherit; margin-top: 18px; margin-bottom: 9px; font-size: 157.1%; margin: 1.27em 0 0 0; font-weight: bold; line-height: 1'>Interpreting First Model<a href="#Interpreting-First-Model" style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; background-color: transparent; color: #337ab7; text-decoration: none"></a></h2><p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left; margin-top: 1em">Initialize interpretation object and plot confusion matrix</p>
<div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; background: #f8f8f8"><pre style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; overflow: auto; font-family: monospace; display: block; word-break: break-all; word-wrap: break-word; border-radius: 2px; line-height: inherit; white-space: pre; margin: 1em 2em; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0"><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box"></span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">interp</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">=</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">ClassificationInterpretation</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">from_learner</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">learn</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">)</span>
<span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">interp</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">plot_confusion_matrix</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">()</span>
</pre></div>
</div>
</div>
</div>
<div style="border-radius: 2px; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; border-width: 1px; border-style: solid; border-color: transparent; width: 100%; padding: 5px; margin: 0; outline: none; border-left-width: 1px; padding-left: 5px; background: linear-gradient(to right, transparent -40px, transparent 1px, transparent 1px, transparent 100%); -webkit-box-orient: horizontal; -webkit-box-align: stretch; -moz-box-orient: horizontal; -moz-box-align: stretch; box-orient: horizontal; box-align: stretch; display: flex; flex-direction: row; align-items: stretch"><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; padding: 0.4em; margin: 0; font-family: monospace; text-align: right; line-height: 1.21429em; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; cursor: default; color: #303F9F; border-top: 1px solid transparent; padding-top: 5pt; min-width: 0">
</div><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; -moz-box-orient: vertical; -moz-box-align: stretch; box-orient: vertical; box-align: stretch; display: flex; flex-direction: column; align-items: stretch; -webkit-box-flex: 1; -moz-box-flex: 1; box-flex: 1; flex: 1">
<div style="outline: none; resize: none; width: inherit; border-style: none; padding: 0.5em 0.5em 0.5em 0.4em; color: #000; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; overflow-x: auto; overflow-y: hidden">
<div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">
<img align="left" src="https://raw.githubusercontent.com/theadammurphy/computer_vision/master/apple_classifier/final_html/img/img2.png" style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; border: 0; vertical-align: middle; display: block; margin-left: auto; margin-right: auto; max-width: 100%; height: auto" width="400/"/>
</div>
</div>
</div>
</div>
<div style="border-radius: 2px; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; border-width: 1px; border-style: solid; border-color: transparent; width: 100%; padding: 5px; margin: 0; outline: none; border-left-width: 1px; padding-left: 5px; background: linear-gradient(to right, transparent -40px, transparent 1px, transparent 1px, transparent 100%); -webkit-box-orient: horizontal; -webkit-box-align: stretch; -moz-box-orient: horizontal; -moz-box-align: stretch; box-orient: horizontal; box-align: stretch; display: flex; flex-direction: row; align-items: stretch"><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; padding: 0.4em; margin: 0; font-family: monospace; text-align: right; line-height: 1.21429em; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; cursor: default; color: #303F9F; border-top: 1px solid transparent; padding-top: 5pt; min-width: 0">
</div><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; -moz-box-orient: vertical; -moz-box-align: stretch; box-orient: vertical; box-align: stretch; display: flex; flex-direction: column; align-items: stretch; -webkit-box-flex: 1; -moz-box-flex: 1; box-flex: 1; flex: 1">
<div style="outline: none; resize: none; width: inherit; border-style: none; padding: 0.5em 0.5em 0.5em 0.4em; color: #000; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; overflow-x: auto; overflow-y: hidden">
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">The model seems to be good at classifying both Granny Smith and Red Delicious apples as they have the highest number of correct predictions by far.</p>
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">It's also seems like it can distinguish between red and green apples quite well but finds it harder to distinguish between apples in their own category. If we look at the <code style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: monospace; border-radius: 2px; white-space: pre; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0">golden_delicious</code> column, we see that it gets most confused between Opals and Granny Smith's rather than between itself and Pink Ladies and or Red Delicious. This is one of the main benefits of using a pretrained model, for one thing, it can already tell the difference between red and green.</p>
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">Now let's look at one of the most helpful parts of the fastai library - seeing which images it was most wrong about.</p>
<div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; background: #f8f8f8"><pre style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; overflow: auto; font-family: monospace; display: block; word-break: break-all; word-wrap: break-word; border-radius: 2px; line-height: inherit; white-space: pre; margin: 1em 2em; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0"><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box"></span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">interp</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">plot_top_losses</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">12</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">)</span>
</pre></div>
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">The top losses are the images where the model was not confident with its prediction or where it was very confident and wrong. We are able to review and remove any incorrect images to improve our model rather than scanning through every single image that we've downloaded.</p>
</div>
</div>
</div>
<div style="border-radius: 2px; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; border-width: 1px; border-style: solid; border-color: transparent; width: 100%; padding: 5px; margin: 0; outline: none; border-left-width: 1px; padding-left: 5px; background: linear-gradient(to right, transparent -40px, transparent 1px, transparent 1px, transparent 100%); -webkit-box-orient: horizontal; -webkit-box-align: stretch; -moz-box-orient: horizontal; -moz-box-align: stretch; box-orient: horizontal; box-align: stretch; display: flex; flex-direction: row; align-items: stretch"><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; padding: 0.4em; margin: 0; font-family: monospace; text-align: right; line-height: 1.21429em; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; cursor: default; color: #303F9F; border-top: 1px solid transparent; padding-top: 5pt; min-width: 0">
</div><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; -moz-box-orient: vertical; -moz-box-align: stretch; box-orient: vertical; box-align: stretch; display: flex; flex-direction: column; align-items: stretch; -webkit-box-flex: 1; -moz-box-flex: 1; box-flex: 1; flex: 1">
<div style="outline: none; resize: none; width: inherit; border-style: none; padding: 0.5em 0.5em 0.5em 0.4em; color: #000; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; overflow-x: auto; overflow-y: hidden">
<div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">
<img align="left" src="https://raw.githubusercontent.com/theadammurphy/computer_vision/master/apple_classifier/final_html/img/img3.png" style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; border: 0; vertical-align: middle; display: block; margin-left: auto; margin-right: auto; max-width: 100%; height: auto" width="600/"/>
</div>
</div>
</div>
</div>
<div style="border-radius: 2px; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; border-width: 1px; border-style: solid; border-color: transparent; width: 100%; padding: 5px; margin: 0; outline: none; border-left-width: 1px; padding-left: 5px; background: linear-gradient(to right, transparent -40px, transparent 1px, transparent 1px, transparent 100%); -webkit-box-orient: horizontal; -webkit-box-align: stretch; -moz-box-orient: horizontal; -moz-box-align: stretch; box-orient: horizontal; box-align: stretch; display: flex; flex-direction: row; align-items: stretch"><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; padding: 0.4em; margin: 0; font-family: monospace; text-align: right; line-height: 1.21429em; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; cursor: default; color: #303F9F; border-top: 1px solid transparent; padding-top: 5pt; min-width: 0">
</div><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; -moz-box-orient: vertical; -moz-box-align: stretch; box-orient: vertical; box-align: stretch; display: flex; flex-direction: column; align-items: stretch; -webkit-box-flex: 1; -moz-box-flex: 1; box-flex: 1; flex: 1">
<div style="outline: none; resize: none; width: inherit; border-style: none; padding: 0.5em 0.5em 0.5em 0.4em; color: #000; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; overflow-x: auto; overflow-y: hidden">
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">Clearly there are lots of images in our dataset that are not what we want! There are images with red and green apples in, the image on the far right middl is a metal container of some kind and the bottom right is a fruit salad.</p>
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">Now we have to do some manual (boo!) data cleaning but unfortunately there is no other way to do it...</p>
<h2 style='-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; color: inherit; margin-top: 18px; margin-bottom: 9px; font-size: 157.1%; margin: 1.27em 0 0 0; font-weight: bold; line-height: 1'>Data Cleaning with Widgets<a href="#Data-Cleaning-with-Widgets" style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; background-color: transparent; color: #337ab7; text-decoration: none"></a></h2><p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left; margin-top: 1em">We're going to use the ImageCleaner widget from the fastai library. Unfortunately, this does not work in Google Colab, so we must switch to a Jupyter Notebook for it to run correctly. This is one reason why we save our models - they can be loaded into Jupyter to do this kind of cleaning.</p>
<div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; background: #f8f8f8"><pre style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; overflow: auto; font-family: monospace; display: block; word-break: break-all; word-wrap: break-word; border-radius: 2px; line-height: inherit; white-space: pre; margin: 1em 2em; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0"><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box"></span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #008000; font-weight: bold">from</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #00F; font-weight: bold">fastai.widgets</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #008000; font-weight: bold">import</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">*</span>
</pre></div>
<h2 style='-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; color: inherit; margin-top: 18px; margin-bottom: 9px; font-size: 157.1%; margin: 1.27em 0 0 0; font-weight: bold; line-height: 1'>from_toplosses()<a href="#from_toplosses()" style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; background-color: transparent; color: #337ab7; text-decoration: none"></a></h2><p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left; margin-top: 1em">We'll first look at the images that had the highest losses as these are the most likely to be nosiy/unwanted.</p>
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">Let's create a new databunch containing all of our images including our validation set.</p>
<div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; background: #f8f8f8"><pre style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; overflow: auto; font-family: monospace; display: block; word-break: break-all; word-wrap: break-word; border-radius: 2px; line-height: inherit; white-space: pre; margin: 1em 2em; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0"><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box"></span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">db</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">=</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">ImageList</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">from_folder</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">path</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">)</span>
                 <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">split_none</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">()</span>
                 <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">label_from_folder</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">()</span>
                 <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">transform</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">get_transforms</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(),</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">size</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">=</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">224</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">)</span>
                 <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">databunch</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">()</span>
     <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">)</span>
</pre></div>
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">Now we load in our learner.</p>
<div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; background: #f8f8f8"><pre style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; overflow: auto; font-family: monospace; display: block; word-break: break-all; word-wrap: break-word; border-radius: 2px; line-height: inherit; white-space: pre; margin: 1em 2em; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0"><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box"></span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">learn_clean</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">=</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">cnn_learner</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">db</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">models</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">resnet34</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">metrics</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">=</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">error_rate</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">)</span>
<span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">learn_clean</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">load</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #BA2121">'stage-1'</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">)</span>
</pre></div>
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">And create a <code style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: monospace; border-radius: 2px; white-space: pre; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0">DatasetFormatter</code> object which lets us modify our dataset.</p>
<div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; background: #f8f8f8"><pre style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; overflow: auto; font-family: monospace; display: block; word-break: break-all; word-wrap: break-word; border-radius: 2px; line-height: inherit; white-space: pre; margin: 1em 2em; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0"><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box"></span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">ds</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">idxs</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">=</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">DatasetFormatter</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">from_toplosses</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">learn_clean</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">)</span>
</pre></div>
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">We store the dataset (i.e. all the image files) and the indexes of them in <code style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: monospace; border-radius: 2px; white-space: pre; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0">ds</code> and <code style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: monospace; border-radius: 2px; white-space: pre; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0">idxs</code> respectively. Because we used <code style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: monospace; border-radius: 2px; white-space: pre; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0">from_toplosses()</code> the two objects are both in descending order of losses starting with the highest loss.</p>
<div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; background: #f8f8f8"><pre style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; overflow: auto; font-family: monospace; display: block; word-break: break-all; word-wrap: break-word; border-radius: 2px; line-height: inherit; white-space: pre; margin: 1em 2em; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0"><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box"></span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">ImageCleaner</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">ds</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">idxs</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">path</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">)</span>
</pre></div>
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">Finally, pass them to <code style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: monospace; border-radius: 2px; white-space: pre; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0">ImageCleaner</code> to open up the widget. You can choose to relabel certain images or delete them. This will not actually delete them from the system but store them in <code style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: monospace; border-radius: 2px; white-space: pre; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0">cleaned.csv</code> which you can then use to create a new databunch and build a new model with. Regardless of what your current working directory is, <code style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: monospace; border-radius: 2px; white-space: pre; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0">cleaned.csv</code> is stored in <code style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: monospace; border-radius: 2px; white-space: pre; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0">path</code>.</p>
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">Go through the images until you do 2-3 passes of images that don't need to be modified.</p>
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">Great! We've now removed loads of nosiy/unwanted images. Now let's do the same process to remove duplicate images.</p>
<h2 style='-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; color: inherit; margin-top: 18px; margin-bottom: 9px; font-size: 157.1%; margin: 1.27em 0 0 0; font-weight: bold; line-height: 1'>from_similars()<a href="#from_similars()" style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; background-color: transparent; color: #337ab7; text-decoration: none"></a></h2><p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left; margin-top: 1em">The <code style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: monospace; border-radius: 2px; white-space: pre; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0">from_similars()</code> method on <code style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: monospace; border-radius: 2px; white-space: pre; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0">DatasetFormatter</code> will return the entire dataset but ordered in descending order with images that are the most similar first. So, you'll be able to find duplicate/identical images very quickly and remove them.</p>
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">The following code is (appropriately) similar to that above, so it is just presented with comments.</p>
<div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; background: #f8f8f8"><pre style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; overflow: auto; font-family: monospace; display: block; word-break: break-all; word-wrap: break-word; border-radius: 2px; line-height: inherit; white-space: pre; margin: 1em 2em; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0"><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box"></span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #408080; font-style: italic"># Create new databunch with cleaned.csv</span>
<span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">db</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">=</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">ImageList</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">from_csv</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">path</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #BA2121">'cleaned.csv'</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">folder</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">=</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #BA2121">'.'</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">)</span>
                 <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">split_none</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">()</span>
                 <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">label_from_df</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">()</span>
                 <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">transform</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">get_transforms</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(),</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">size</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">=</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">224</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">)</span>
                 <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">databunch</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">()</span>
     <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">)</span>

<span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #408080; font-style: italic"># Initialize new learner and load pre-trained model</span>
<span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">learn_clean</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">=</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">cnn_learner</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">db</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">models</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">resnet34</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">)</span>
<span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">learn_clean</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">load</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #BA2121">'stage-1'</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">)</span>

<span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #408080; font-style: italic"># Use .from_similars()</span>
<span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">ds</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">idxs</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">=</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">DatasetFormatter</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">from_similars</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">learn_clean</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">)</span>

<span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #408080; font-style: italic"># Start ImageCleaner to look for duplicates</span>
<span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">ImageCleaner</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">ds</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">idxs</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">path</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">duplicates</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">=</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #008000; font-weight: bold">True</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">)</span>
</pre></div>
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">Go through the same process until you are happy you've removed a large number of duplicate images. The <code style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: monospace; border-radius: 2px; white-space: pre; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0">cleaned.csv</code> file is automatically updated on each iteration.</p>
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">Now that the data has been cleaned, it's time to re-train the model.</p>
<h2 style='-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; color: inherit; margin-top: 18px; margin-bottom: 9px; font-size: 157.1%; margin: 1.27em 0 0 0; font-weight: bold; line-height: 1'>Training Cleaned Model<a href="#Training-Cleaned-Model" style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; background-color: transparent; color: #337ab7; text-decoration: none"></a></h2><p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left; margin-top: 1em">First we need to create a databunch from <code style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: monospace; border-radius: 2px; white-space: pre; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0">cleaned.csv</code>.</p>
<div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; background: #f8f8f8"><pre style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; overflow: auto; font-family: monospace; display: block; word-break: break-all; word-wrap: break-word; border-radius: 2px; line-height: inherit; white-space: pre; margin: 1em 2em; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0"><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box"></span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #408080; font-style: italic"># Same random seed as before</span>
<span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">np</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">random</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">seed</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">42</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">)</span>

<span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #408080; font-style: italic"># from_csv rather than from_folder</span>
<span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">data</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">=</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">ImageDataBunch</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">from_csv</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">path</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">folder</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">=</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #BA2121">'.'</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">valid_pct</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">=</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">0.2</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span>
                               <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">csv_labels</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">=</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #BA2121">'cleaned.csv'</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">ds_tfms</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">=</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">get_transforms</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(),</span>
                               <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">size</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">=</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">224</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">num_workers</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">=</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">4</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">)</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">normalize</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">imagenet_stats</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">)</span>
</pre></div>
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">In the first iteration, I removed 22% of the data, let's see what accuracy gains that gives us.</p>
<div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; background: #f8f8f8"><pre style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; overflow: auto; font-family: monospace; display: block; word-break: break-all; word-wrap: break-word; border-radius: 2px; line-height: inherit; white-space: pre; margin: 1em 2em; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0"><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box"></span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">learn</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">=</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">cnn_learner</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">data</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">models</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">resnet34</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">metrics</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">=</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">error_rate</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">)</span>
<span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">learn</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">fit_one_cycle</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">4</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">)</span>
</pre></div>
</div>
</div>
</div>
<div style="border-radius: 2px; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; border-width: 1px; border-style: solid; border-color: transparent; width: 100%; padding: 5px; margin: 0; outline: none; border-left-width: 1px; padding-left: 5px; background: linear-gradient(to right, transparent -40px, transparent 1px, transparent 1px, transparent 100%); -webkit-box-orient: horizontal; -webkit-box-align: stretch; -moz-box-orient: horizontal; -moz-box-align: stretch; box-orient: horizontal; box-align: stretch; display: flex; flex-direction: row; align-items: stretch"><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; padding: 0.4em; margin: 0; font-family: monospace; text-align: right; line-height: 1.21429em; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; cursor: default; color: #303F9F; border-top: 1px solid transparent; padding-top: 5pt; min-width: 0">
</div><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; -moz-box-orient: vertical; -moz-box-align: stretch; box-orient: vertical; box-align: stretch; display: flex; flex-direction: column; align-items: stretch; -webkit-box-flex: 1; -moz-box-flex: 1; box-flex: 1; flex: 1">
<div style="outline: none; resize: none; width: inherit; border-style: none; padding: 0.5em 0.5em 0.5em 0.4em; color: #000; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; overflow-x: auto; overflow-y: hidden">
<div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">
<img align="left" src="https://raw.githubusercontent.com/theadammurphy/computer_vision/master/apple_classifier/final_html/img/img4.png" style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; border: 0; vertical-align: middle; display: block; margin-left: auto; margin-right: auto; max-width: 100%; height: auto" width="400/"/>
</div>
</div>
</div>
</div>
<div style="border-radius: 2px; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; border-width: 1px; border-style: solid; border-color: transparent; width: 100%; padding: 5px; margin: 0; outline: none; border-left-width: 1px; padding-left: 5px; background: linear-gradient(to right, transparent -40px, transparent 1px, transparent 1px, transparent 100%); -webkit-box-orient: horizontal; -webkit-box-align: stretch; -moz-box-orient: horizontal; -moz-box-align: stretch; box-orient: horizontal; box-align: stretch; display: flex; flex-direction: row; align-items: stretch"><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; padding: 0.4em; margin: 0; font-family: monospace; text-align: right; line-height: 1.21429em; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; cursor: default; color: #303F9F; border-top: 1px solid transparent; padding-top: 5pt; min-width: 0">
</div><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; -moz-box-orient: vertical; -moz-box-align: stretch; box-orient: vertical; box-align: stretch; display: flex; flex-direction: column; align-items: stretch; -webkit-box-flex: 1; -moz-box-flex: 1; box-flex: 1; flex: 1">
<div style="outline: none; resize: none; width: inherit; border-style: none; padding: 0.5em 0.5em 0.5em 0.4em; color: #000; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; overflow-x: auto; overflow-y: hidden">
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">Accuracy increased from 61.3% to 72.3% which is a 17.9% improvement on the initial model. This is a huge step forwards.</p>
<div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; background: #f8f8f8"><pre style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; overflow: auto; font-family: monospace; display: block; word-break: break-all; word-wrap: break-word; border-radius: 2px; line-height: inherit; white-space: pre; margin: 1em 2em; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0"><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box"></span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">learn</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">save</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #BA2121">'stage-2'</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">)</span>
</pre></div>
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">Up to now, we've just been training the last few layers of resnet34. Since we've now got a decent level of accuracy, let's train the entire model by first unfreezing the layers and using the learning rate finder and plotting its results.</p>
<div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; background: #f8f8f8"><pre style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; overflow: auto; font-family: monospace; display: block; word-break: break-all; word-wrap: break-word; border-radius: 2px; line-height: inherit; white-space: pre; margin: 1em 2em; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0"><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box"></span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">learn</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">unfreeze</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">()</span>
<span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">learn</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">lr_find</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">()</span>
<span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">learn</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">recorder</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">plot</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">()</span>
</pre></div>
</div>
</div>
</div>
<div style="border-radius: 2px; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; border-width: 1px; border-style: solid; border-color: transparent; width: 100%; padding: 5px; margin: 0; outline: none; border-left-width: 1px; padding-left: 5px; background: linear-gradient(to right, transparent -40px, transparent 1px, transparent 1px, transparent 100%); -webkit-box-orient: horizontal; -webkit-box-align: stretch; -moz-box-orient: horizontal; -moz-box-align: stretch; box-orient: horizontal; box-align: stretch; display: flex; flex-direction: row; align-items: stretch"><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; padding: 0.4em; margin: 0; font-family: monospace; text-align: right; line-height: 1.21429em; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; cursor: default; color: #303F9F; border-top: 1px solid transparent; padding-top: 5pt; min-width: 0">
</div><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; -moz-box-orient: vertical; -moz-box-align: stretch; box-orient: vertical; box-align: stretch; display: flex; flex-direction: column; align-items: stretch; -webkit-box-flex: 1; -moz-box-flex: 1; box-flex: 1; flex: 1">
<div style="outline: none; resize: none; width: inherit; border-style: none; padding: 0.5em 0.5em 0.5em 0.4em; color: #000; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; overflow-x: auto; overflow-y: hidden">
<div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">
<img align="left" src="https://raw.githubusercontent.com/theadammurphy/computer_vision/master/apple_classifier/final_html/img/img5.png" style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; border: 0; vertical-align: middle; display: block; margin-left: auto; margin-right: auto; max-width: 100%; height: auto" width="400/"/>
</div>
</div>
</div>
</div>
<div style="border-radius: 2px; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; border-width: 1px; border-style: solid; border-color: transparent; width: 100%; padding: 5px; margin: 0; outline: none; border-left-width: 1px; padding-left: 5px; background: linear-gradient(to right, transparent -40px, transparent 1px, transparent 1px, transparent 100%); -webkit-box-orient: horizontal; -webkit-box-align: stretch; -moz-box-orient: horizontal; -moz-box-align: stretch; box-orient: horizontal; box-align: stretch; display: flex; flex-direction: row; align-items: stretch"><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; padding: 0.4em; margin: 0; font-family: monospace; text-align: right; line-height: 1.21429em; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; cursor: default; color: #303F9F; border-top: 1px solid transparent; padding-top: 5pt; min-width: 0">
</div><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; -moz-box-orient: vertical; -moz-box-align: stretch; box-orient: vertical; box-align: stretch; display: flex; flex-direction: column; align-items: stretch; -webkit-box-flex: 1; -moz-box-flex: 1; box-flex: 1; flex: 1">
<div style="outline: none; resize: none; width: inherit; border-style: none; padding: 0.5em 0.5em 0.5em 0.4em; color: #000; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; overflow-x: auto; overflow-y: hidden">
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">We want to find the steepest part of the slope which looks like it starts at around <code style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: monospace; border-radius: 2px; white-space: pre; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0">2e-5</code>, so let's run the model a few more times using a slice of learning rates.</p>
<div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; background: #f8f8f8"><pre style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; overflow: auto; font-family: monospace; display: block; word-break: break-all; word-wrap: break-word; border-radius: 2px; line-height: inherit; white-space: pre; margin: 1em 2em; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0"><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box"></span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">learn</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">fit_one_cycle</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">2</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">max_lr</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">=</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #008000">slice</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">2e-5</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">,</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">1e-3</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">))</span>
</pre></div>
</div>
</div>
</div>
<div style="border-radius: 2px; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; border-width: 1px; border-style: solid; border-color: transparent; width: 100%; padding: 5px; margin: 0; outline: none; border-left-width: 1px; padding-left: 5px; background: linear-gradient(to right, transparent -40px, transparent 1px, transparent 1px, transparent 100%); -webkit-box-orient: horizontal; -webkit-box-align: stretch; -moz-box-orient: horizontal; -moz-box-align: stretch; box-orient: horizontal; box-align: stretch; display: flex; flex-direction: row; align-items: stretch"><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; padding: 0.4em; margin: 0; font-family: monospace; text-align: right; line-height: 1.21429em; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; cursor: default; color: #303F9F; border-top: 1px solid transparent; padding-top: 5pt; min-width: 0">
</div><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; -moz-box-orient: vertical; -moz-box-align: stretch; box-orient: vertical; box-align: stretch; display: flex; flex-direction: column; align-items: stretch; -webkit-box-flex: 1; -moz-box-flex: 1; box-flex: 1; flex: 1">
<div style="outline: none; resize: none; width: inherit; border-style: none; padding: 0.5em 0.5em 0.5em 0.4em; color: #000; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; overflow-x: auto; overflow-y: hidden">
<div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">
<img align="left" src="https://raw.githubusercontent.com/theadammurphy/computer_vision/master/apple_classifier/final_html/img/img6.png" style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; border: 0; vertical-align: middle; display: block; margin-left: auto; margin-right: auto; max-width: 100%; height: auto" width="400/"/>
</div>
</div>
</div>
</div>
<div style="border-radius: 2px; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; border-width: 1px; border-style: solid; border-color: transparent; width: 100%; padding: 5px; margin: 0; outline: none; border-left-width: 1px; padding-left: 5px; background: linear-gradient(to right, transparent -40px, transparent 1px, transparent 1px, transparent 100%); -webkit-box-orient: horizontal; -webkit-box-align: stretch; -moz-box-orient: horizontal; -moz-box-align: stretch; box-orient: horizontal; box-align: stretch; display: flex; flex-direction: row; align-items: stretch"><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; padding: 0.4em; margin: 0; font-family: monospace; text-align: right; line-height: 1.21429em; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; cursor: default; color: #303F9F; border-top: 1px solid transparent; padding-top: 5pt; min-width: 0">
</div><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; -moz-box-orient: vertical; -moz-box-align: stretch; box-orient: vertical; box-align: stretch; display: flex; flex-direction: column; align-items: stretch; -webkit-box-flex: 1; -moz-box-flex: 1; box-flex: 1; flex: 1">
<div style="outline: none; resize: none; width: inherit; border-style: none; padding: 0.5em 0.5em 0.5em 0.4em; color: #000; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; overflow-x: auto; overflow-y: hidden">
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">Great, the accuracy is now up to 77.9%.</p>
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">Let's look at the confusion matrix and top losses to see if the incorrect predictions are caused by noisy data.</p>
<div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; background: #f8f8f8"><pre style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; overflow: auto; font-family: monospace; display: block; word-break: break-all; word-wrap: break-word; border-radius: 2px; line-height: inherit; white-space: pre; margin: 1em 2em; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0"><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box"></span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">interp</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">=</span> <span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">ClassificationInterpretation</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">from_learner</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">learn</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">)</span>
<span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">interp</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">plot_confusion_matrix</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">()</span>
</pre></div>
</div>
</div>
</div>
<div style="border-radius: 2px; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; border-width: 1px; border-style: solid; border-color: transparent; width: 100%; padding: 5px; margin: 0; outline: none; border-left-width: 1px; padding-left: 5px; background: linear-gradient(to right, transparent -40px, transparent 1px, transparent 1px, transparent 100%); -webkit-box-orient: horizontal; -webkit-box-align: stretch; -moz-box-orient: horizontal; -moz-box-align: stretch; box-orient: horizontal; box-align: stretch; display: flex; flex-direction: row; align-items: stretch"><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; padding: 0.4em; margin: 0; font-family: monospace; text-align: right; line-height: 1.21429em; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; cursor: default; color: #303F9F; border-top: 1px solid transparent; padding-top: 5pt; min-width: 0">
</div><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; -moz-box-orient: vertical; -moz-box-align: stretch; box-orient: vertical; box-align: stretch; display: flex; flex-direction: column; align-items: stretch; -webkit-box-flex: 1; -moz-box-flex: 1; box-flex: 1; flex: 1">
<div style="outline: none; resize: none; width: inherit; border-style: none; padding: 0.5em 0.5em 0.5em 0.4em; color: #000; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; overflow-x: auto; overflow-y: hidden">
<div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">
<img align="left" src="https://raw.githubusercontent.com/theadammurphy/computer_vision/master/apple_classifier/final_html/img/img7.png" style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; border: 0; vertical-align: middle; display: block; margin-left: auto; margin-right: auto; max-width: 100%; height: auto" width="400/"/>
</div>
</div>
</div>
</div>
<div style="border-radius: 2px; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; border-width: 1px; border-style: solid; border-color: transparent; width: 100%; padding: 5px; margin: 0; outline: none; border-left-width: 1px; padding-left: 5px; background: linear-gradient(to right, transparent -40px, transparent 1px, transparent 1px, transparent 100%); -webkit-box-orient: horizontal; -webkit-box-align: stretch; -moz-box-orient: horizontal; -moz-box-align: stretch; box-orient: horizontal; box-align: stretch; display: flex; flex-direction: row; align-items: stretch"><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; padding: 0.4em; margin: 0; font-family: monospace; text-align: right; line-height: 1.21429em; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; cursor: default; color: #303F9F; border-top: 1px solid transparent; padding-top: 5pt; min-width: 0">
</div><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; -moz-box-orient: vertical; -moz-box-align: stretch; box-orient: vertical; box-align: stretch; display: flex; flex-direction: column; align-items: stretch; -webkit-box-flex: 1; -moz-box-flex: 1; box-flex: 1; flex: 1">
<div style="outline: none; resize: none; width: inherit; border-style: none; padding: 0.5em 0.5em 0.5em 0.4em; color: #000; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; overflow-x: auto; overflow-y: hidden">
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">The model seems to be great at distinguishing between most of the varieties of apple apart from Pink Lady. That category has, by far, the highest number of incorrect predicitions.</p>
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">Let's look at the top losses.</p>
<div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; background: #f8f8f8"><pre style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; overflow: auto; font-family: monospace; display: block; word-break: break-all; word-wrap: break-word; border-radius: 2px; line-height: inherit; white-space: pre; margin: 1em 2em; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0"><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box"></span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">interp</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">.</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">plot_top_losses</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">(</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; color: #666">20</span><span style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">)</span>
</pre></div>
</div>
</div>
</div>
<div style="border-radius: 2px; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; border-width: 1px; border-style: solid; border-color: transparent; width: 100%; padding: 5px; margin: 0; outline: none; border-left-width: 1px; padding-left: 5px; background: linear-gradient(to right, transparent -40px, transparent 1px, transparent 1px, transparent 100%); -webkit-box-orient: horizontal; -webkit-box-align: stretch; -moz-box-orient: horizontal; -moz-box-align: stretch; box-orient: horizontal; box-align: stretch; display: flex; flex-direction: row; align-items: stretch"><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; padding: 0.4em; margin: 0; font-family: monospace; text-align: right; line-height: 1.21429em; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; cursor: default; color: #303F9F; border-top: 1px solid transparent; padding-top: 5pt; min-width: 0">
</div><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; -moz-box-orient: vertical; -moz-box-align: stretch; box-orient: vertical; box-align: stretch; display: flex; flex-direction: column; align-items: stretch; -webkit-box-flex: 1; -moz-box-flex: 1; box-flex: 1; flex: 1">
<div style="outline: none; resize: none; width: inherit; border-style: none; padding: 0.5em 0.5em 0.5em 0.4em; color: #000; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; overflow-x: auto; overflow-y: hidden">
<div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">
<img align="left" src="https://raw.githubusercontent.com/theadammurphy/computer_vision/master/apple_classifier/final_html/img/img8.png" style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; border: 0; vertical-align: middle; display: block; margin-left: auto; margin-right: auto; max-width: 100%; height: auto" width="600/"/>
</div>
</div>
</div>
</div>
<div style="border-radius: 2px; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; border-width: 1px; border-style: solid; border-color: transparent; width: 100%; padding: 5px; margin: 0; outline: none; border-left-width: 1px; padding-left: 5px; background: linear-gradient(to right, transparent -40px, transparent 1px, transparent 1px, transparent 100%); -webkit-box-orient: horizontal; -webkit-box-align: stretch; -moz-box-orient: horizontal; -moz-box-align: stretch; box-orient: horizontal; box-align: stretch; display: flex; flex-direction: row; align-items: stretch"><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; padding: 0.4em; margin: 0; font-family: monospace; text-align: right; line-height: 1.21429em; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; cursor: default; color: #303F9F; border-top: 1px solid transparent; padding-top: 5pt; min-width: 0">
</div><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; -moz-box-orient: vertical; -moz-box-align: stretch; box-orient: vertical; box-align: stretch; display: flex; flex-direction: column; align-items: stretch; -webkit-box-flex: 1; -moz-box-flex: 1; box-flex: 1; flex: 1">
<div style="outline: none; resize: none; width: inherit; border-style: none; padding: 0.5em 0.5em 0.5em 0.4em; color: #000; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; overflow-x: auto; overflow-y: hidden">
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">Looking at the losses a few things emerge:</p>
<ol style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin-top: 0; margin-bottom: 9px; list-style: decimal; margin: 0 2em; padding-left: 0">
<li style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">Some images clearly should not be there e.g. bottles of brandy and some that contain both red and green apples</li>
<li style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">Apples are very similar </li>
</ol>
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">As someone who has mainly eaten braeburn and pink lady apples for most of his life, when I look at some of the images of pink ladies, I think they are braeburns and vice versa.</p>
</div>
</div>
</div>
<div style="border-radius: 2px; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; border-width: 1px; border-style: solid; border-color: transparent; width: 100%; padding: 5px; margin: 0; outline: none; border-left-width: 1px; padding-left: 5px; background: linear-gradient(to right, transparent -40px, transparent 1px, transparent 1px, transparent 100%); -webkit-box-orient: horizontal; -webkit-box-align: stretch; -moz-box-orient: horizontal; -moz-box-align: stretch; box-orient: horizontal; box-align: stretch; display: flex; flex-direction: row; align-items: stretch"><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; padding: 0.4em; margin: 0; font-family: monospace; text-align: right; line-height: 1.21429em; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; cursor: default; color: #303F9F; border-top: 1px solid transparent; padding-top: 5pt; min-width: 0">
</div><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; -moz-box-orient: vertical; -moz-box-align: stretch; box-orient: vertical; box-align: stretch; display: flex; flex-direction: column; align-items: stretch; -webkit-box-flex: 1; -moz-box-flex: 1; box-flex: 1; flex: 1">
<div style="outline: none; resize: none; width: inherit; border-style: none; padding: 0.5em 0.5em 0.5em 0.4em; color: #000; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; overflow-x: auto; overflow-y: hidden">
<div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">
<img align="left" src="https://raw.githubusercontent.com/theadammurphy/computer_vision/master/apple_classifier/final_html/img/img9.png" style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; border: 0; vertical-align: middle; display: block; margin-left: auto; margin-right: auto; max-width: 100%; height: auto" width="400/"/>
</div>
</div>
</div>
</div>
<div style="border-radius: 2px; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; border-width: 1px; border-style: solid; border-color: transparent; width: 100%; padding: 5px; margin: 0; outline: none; border-left-width: 1px; padding-left: 5px; background: linear-gradient(to right, transparent -40px, transparent 1px, transparent 1px, transparent 100%); -webkit-box-orient: horizontal; -webkit-box-align: stretch; -moz-box-orient: horizontal; -moz-box-align: stretch; box-orient: horizontal; box-align: stretch; display: flex; flex-direction: row; align-items: stretch"><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; padding: 0.4em; margin: 0; font-family: monospace; text-align: right; line-height: 1.21429em; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; cursor: default; color: #303F9F; border-top: 1px solid transparent; padding-top: 5pt; min-width: 0">
</div><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; -moz-box-orient: vertical; -moz-box-align: stretch; box-orient: vertical; box-align: stretch; display: flex; flex-direction: column; align-items: stretch; -webkit-box-flex: 1; -moz-box-flex: 1; box-flex: 1; flex: 1">
<div style="outline: none; resize: none; width: inherit; border-style: none; padding: 0.5em 0.5em 0.5em 0.4em; color: #000; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; overflow-x: auto; overflow-y: hidden">
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">If you were to show me the above image, I would say it was a Pink Lady with a Braeburn sticker on it. This is great because it means are model is making mistakes that even humans would make.</p>
<h2 style='-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; color: inherit; margin-top: 18px; margin-bottom: 9px; font-size: 157.1%; margin: 1.27em 0 0 0; font-weight: bold; line-height: 1'>Fine Tuning<a href="#Fine-Tuning" style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; background-color: transparent; color: #337ab7; text-decoration: none"></a></h2><p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left; margin-top: 1em">Now that we know the resnet34 model is working well, it is time to</p>
<ol style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin-top: 0; margin-bottom: 9px; list-style: decimal; margin: 0 2em; padding-left: 0">
<li style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">Do further data cleaning by removing more incorrect images, and</li>
<li style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">Train a full resnet50 model</li>
</ol>
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">These steps are pretty much identical to the ones I did above, so, for brevity, I will not show the code. The only real difference is that we use <code style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: monospace; border-radius: 2px; white-space: pre; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0">models.resnet50</code> when creating <code style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: monospace; border-radius: 2px; white-space: pre; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0">learn</code> instead of <code style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; font-family: monospace; border-radius: 2px; white-space: pre; border: 0; background-color: #fff; color: #000; font-size: 100%; padding: 0">models.resnet34</code>.</p>
</div>
</div>
</div>
<div style="border-radius: 2px; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; border-width: 1px; border-style: solid; border-color: transparent; width: 100%; padding: 5px; margin: 0; outline: none; border-left-width: 1px; padding-left: 5px; background: linear-gradient(to right, transparent -40px, transparent 1px, transparent 1px, transparent 100%); -webkit-box-orient: horizontal; -webkit-box-align: stretch; -moz-box-orient: horizontal; -moz-box-align: stretch; box-orient: horizontal; box-align: stretch; display: flex; flex-direction: row; align-items: stretch"><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; padding: 0.4em; margin: 0; font-family: monospace; text-align: right; line-height: 1.21429em; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; cursor: default; color: #303F9F; border-top: 1px solid transparent; padding-top: 5pt; min-width: 0">
</div><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; -moz-box-orient: vertical; -moz-box-align: stretch; box-orient: vertical; box-align: stretch; display: flex; flex-direction: column; align-items: stretch; -webkit-box-flex: 1; -moz-box-flex: 1; box-flex: 1; flex: 1">
<div style="outline: none; resize: none; width: inherit; border-style: none; padding: 0.5em 0.5em 0.5em 0.4em; color: #000; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; overflow-x: auto; overflow-y: hidden">
<div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box">
<img align="left" src="https://raw.githubusercontent.com/theadammurphy/computer_vision/master/apple_classifier/final_html/img/img10.png" style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; border: 0; vertical-align: middle; display: block; margin-left: auto; margin-right: auto; max-width: 100%; height: auto" width="400/"/>
</div>
</div>
</div>
</div>
<div style="border-radius: 2px; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; border-width: 1px; border-style: solid; border-color: transparent; width: 100%; padding: 5px; margin: 0; outline: none; border-left-width: 1px; padding-left: 5px; background: linear-gradient(to right, transparent -40px, transparent 1px, transparent 1px, transparent 100%); -webkit-box-orient: horizontal; -webkit-box-align: stretch; -moz-box-orient: horizontal; -moz-box-align: stretch; box-orient: horizontal; box-align: stretch; display: flex; flex-direction: row; align-items: stretch"><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; padding: 0.4em; margin: 0; font-family: monospace; text-align: right; line-height: 1.21429em; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; cursor: default; color: #303F9F; border-top: 1px solid transparent; padding-top: 5pt; min-width: 0">
</div><div style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; -moz-box-orient: vertical; -moz-box-align: stretch; box-orient: vertical; box-align: stretch; display: flex; flex-direction: column; align-items: stretch; -webkit-box-flex: 1; -moz-box-flex: 1; box-flex: 1; flex: 1">
<div style="outline: none; resize: none; width: inherit; border-style: none; padding: 0.5em 0.5em 0.5em 0.4em; color: #000; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; overflow-x: auto; overflow-y: hidden">
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">After repeating the above process and training the entire resnet50 model, we achieved an error rate of 19.0%, or an accuracy of 81.0%! Not bad for a model created from a few hundred images taken from Google that started with an accuracy of 61.4%.</p>
<p style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; margin: 1em 0 9px; margin-bottom: 0; text-align: left">Of course, further improvements could be made by getting more data, looking at weight decay and data augmentation but for now, I think 81% accuracy is pretty good, especially given that it is making mistakes that humans (I) would also make.</p>
</div>
</div>
</div>
</div>
</div>
<p align="center" style="font-size: 12px; color: #9d9999;">Wordpress conversion from apple_classifier_write_up.ipynb by <A HREF="https://github.com/bennylp/nb2wp">nb2wp</A> v0.3.1</p>
</body>
</html>
